services:
    twig.extension.text:
        class: Twig_Extensions_Extension_Text
        tags:
            - { name: twig.extension }

    # --- Command
    moustache.command.generate_signup:
        class: "MoustacheBundle\\Command\\GenerateSignupCommand"
        arguments:
            - "@torrent.repository.user"
            - "@torrent.manager.user"
            - "@router"
        tags:
            - { name: console.command }


    # --- Controllers
    moustache.controller.default:
        class: "MoustacheBundle\\Controller\\DefaultController"
        arguments:
            - "@torrent.client.current"
            - "@templating"
            - "@moustache.form.torrent_menu"
    moustache.controller.add:
        class: "MoustacheBundle\\Controller\\AddController"
        arguments:
            - "@moustache.form.torrent_menu"
            - "@torrent.client.current"
            - "@torrent.manager.torrent"
            - "@moustache.service.redirector"
            - "@moustache.shortcut.request"
            - "@logger"
            - "%torrent_rpc_client%"
    moustache.controller.life_cycle:
        class: "MoustacheBundle\\Controller\\LifeCycleController"
        arguments:
            - "@torrent.client.current"
            - "@moustache.service.redirector"
    moustache.controller.remove:
        class: "MoustacheBundle\\Controller\\RemoveController"
        arguments:
            - "@torrent.client.current"
            - "@moustache.service.redirector"
    moustache.controller.signup:
        class: "MoustacheBundle\\Controller\\SignupController"
        arguments:
            - "@templating"
            - "@torrent.manager.user"
            - "@torrent.repository.user"
            - "@moustache.form.signup"
            - "@fos_user.security.login_manager"
            - "@moustache.service.redirector"
            - "@moustache.shortcut.request"

    # --- Event Listeners
    moustache.event.flash_bag_messenger:
        class: "MoustacheBundle\\EventListener\\FlashBagMessengerListener"
        arguments:
            - "@moustache.helper.flash_bag"
        tags:
            - { name: kernel.event_listener, event: kernel.request, method: onKernelRequest, priority: 1 }

    # --- Helper
    moustache.helper.flash_bag:
        class: "MoustacheBundle\\Helper\\FlashBagHelper"
        arguments:
            - "@moustache.service.flash_messager"
            - "@torrent.helper.authenticated_user"
            - "@torrent.manager.user"

    # --- Forms
    moustache.form.torrent_menu:
        class: "MoustacheBundle\\Form\\TorrentMenu"
        factory: 'form.factory:create'
        arguments:
            - "MoustacheBundle\\Form\\TorrentMenu"
            - "@torrent.entity.torrent"
    moustache.form.signup:
        class: "MoustacheBundle\\Form\\Signup"
        factory: 'form.factory:create'
        arguments:
            - "MoustacheBundle\\Form\\Signup"
            - "@torrent.entity.user"

    # --- Services
    moustache.service.flash_messager:
        class: "MoustacheBundle\\Service\\FlashMessenger"
        arguments:
            - "@session"
            - "@translator"
    moustache.service.redirector:
        class: "MoustacheBundle\\Service\\Redirector"
        arguments:
            - "@router"
            - "@moustache.service.flash_messager"

    # --- Shortcut
    moustache.shortcut.request:
        class: "Symfony\\Component\\HttpFoundation\\Request"
        factory: 'request_stack:getCurrentRequest'
